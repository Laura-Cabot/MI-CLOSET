<div class="p-6 md:p-8 bg-white min-h-screen font-inter">
  <header class="mb-8 text-center">
    <h1 class="text-3xl font-extrabold text-gray-800 tracking-tight mb-2">Cat√°logo de Productos</h1>
    <p class="text-gray-500">Explora nuestra colecci√≥n.</p>
  </header>

  <div class="flex flex-col sm:flex-row gap-4 mb-8 justify-center items-start">
    <div class="relative w-full sm:w-1/2 md:w-5/12 lg:w-1/3">
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (keyup.enter)="onSearch()"
        placeholder="Buscar productos..."
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-400 pr-24"
      />

      <button
        (click)="onSearch()"
        class="absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1 bg-rose-500 text-white rounded-md hover:bg-rose-600 transition text-sm"
      >
        Buscar
      </button>

      <ul
        *ngIf="searchQuery.length >= 2"
        class="absolute left-0 right-0 mt-1 bg-white border border-gray-200 rounded-md shadow-md z-50 max-h-64 overflow-auto"
      >
        <li
          *ngFor="let s of suggestions()"
          (click)="onSelectSuggestion(s)"
          class="px-3 py-2 text-sm text-gray-700 hover:bg-rose-50 hover:text-rose-600 cursor-pointer"
        >
          {{ s }}
        </li>
        <li *ngIf="suggestions().length === 0" class="px-3 py-2 text-sm text-gray-500">
          No hay coincidencias‚Ä¶
        </li>
      </ul>
    </div>

    <div class="relative group w-full sm:w-1/2 md:w-5/12 lg:w-1/3">
      <button
        class="w-full py-2 px-4 border border-gray-300 rounded-lg text-sm font-semibold text-gray-800 hover:bg-gray-50 transition flex items-center justify-between"
      >
        <span>{{ selectedCategory || 'Todas las categor√≠as' }}</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-4 h-4 ml-2"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
        </svg>
      </button>

      <div
        class="absolute left-0 top-full mt-1 bg-white shadow-lg rounded-md w-full border border-gray-100 
                   opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 
                   z-[60]"
      >
        <a
          (click)="clearFilters()"
          class="block px-4 py-2 text-sm font-bold text-rose-500 hover:bg-rose-50 cursor-pointer"
        >
          Todas las categor√≠as
        </a>
        <a
          *ngFor="let category of categories"
          (click)="filterByCategory(category)"
          class="block px-4 py-2 text-sm text-gray-700 hover:bg-rose-50 hover:text-rose-500 cursor-pointer"
          [class.font-bold]="category === selectedCategory"
        >
          {{ category }}
        </a>
      </div>
    </div>
  </div>
  <div
    *ngIf="appliedQuery() && filteredProducts().length === 0"
    class="text-center py-4 text-gray-600"
  >
    <p class="text-base font-semibold mb-1">üòï No hay elementos relacionados a tu b√∫squeda</p>
    <p class="text-sm text-gray-500">
      Prob√° con otro t√©rmino o
      <a (click)="clearFilters()" class="text-rose-500 hover:underline cursor-pointer"
        >limpi√° la b√∫squeda</a
      >
      .
    </p>
  </div>

  <section>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
      @for (product of paginatedProducts(); track product.id) {
      <div
        class="w-full bg-white border border-gray-200 rounded-lg shadow-md overflow-hidden hover:shadow-lg transition"
      >
        <div
          class="relative aspect-[4/5] bg-gray-100 flex items-center justify-center overflow-hidden"
        >
          <img [src]="product.image" [alt]="product.name" class="w-full h-full object-cover" />
          <div
            *ngIf="+product.stock === 0"
            class="absolute inset-0 bg-gray-900/40 flex items-center justify-center"
          >
            <span
              class="px-3 py-1 rounded-md bg-white/80 text-gray-800 text-xs font-bold uppercase tracking-wide"
            >
              Agotado
            </span>
          </div>
        </div>

        <div class="p-3 flex flex-col text-sm">
          <span class="text-[10px] font-semibold uppercase tracking-wider text-rose-500 block mb-1">
            {{ product.category }}
          </span>
          <h3 class="text-base font-semibold text-gray-800 mb-1 truncate">
            {{ product.name }}
          </h3>
          <p class="text-lg font-bold text-rose-600 mb-2">
            {{ product.price | currency : 'USD' : 'symbol' : '1.2-2' }}
          </p>

          <button
            (click)="openModal(product)"
            class="w-full py-2 rounded-md bg-rose-400 text-white font-semibold text-sm hover:bg-rose-500 transition disabled:opacity-50"
            [disabled]="+product.stock === 0"
            title="+product.stock === 0 ? 'Producto agotado' : 'Ver m√°s'"
          >
            Ver m√°s
          </button>
        </div>
      </div>
      } @empty {
      <div class="col-span-full" *ngIf="!searchQuery.trim() && allProducts().length === 0">
        <div
          class="w-full flex flex-col items-center justify-center py-20 text-center border border-dashed border-gray-300 rounded-xl bg-white"
        >
          <div class="text-4xl mb-3">üõçÔ∏è</div>
          <p class="text-gray-800 font-semibold mb-1 text-lg">
            Por el momento no hay productos disponibles en esta categor√≠a.
          </p>
          <p class="text-gray-500 text-sm mb-4">
            Explor√° otras secciones o volv√© m√°s tarde para ver las novedades.
          </p>
          <button
            (click)="clearFilters()"
            class="px-5 py-2 bg-rose-500 text-white font-semibold rounded-md shadow hover:bg-rose-600 transition"
          >
            Volver al Cat√°logo
          </button>
        </div>
      </div>
      }
    </div>

    <div *ngIf="totalPages() > 1" class="flex justify-center items-center gap-2 mt-10">
      <button
        (click)="prevPage()"
        [disabled]="currentPage() === 1"
        class="px-3 py-1 bg-gray-100 rounded-md text-gray-700 hover:bg-gray-200 disabled:opacity-50"
      >
        ‚Üê Anterior
      </button>

      <span class="text-sm text-gray-700"> P√°gina {{ currentPage() }} de {{ totalPages() }} </span>

      <button
        (click)="nextPage()"
        [disabled]="currentPage() === totalPages()"
        class="px-3 py-1 bg-gray-100 rounded-md text-gray-700 hover:bg-gray-200 disabled:opacity-50"
      >
        Siguiente ‚Üí
      </button>
    </div>

    <div *ngIf="selectedCategory" class="mt-12 text-center">
      <button
        (click)="clearFilters()"
        class="inline-flex items-center gap-2 bg-rose-500 hover:bg-rose-600 text-white font-semibold px-5 py-2 rounded-lg shadow-md transition"
      >
        ‚Üê Volver al cat√°logo completo
      </button>
    </div>
  </section>

  <div
    *ngIf="showModal && selectedProduct"
    class="fixed inset-0 bg-black/40 flex items-center justify-center z-50"
  >
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6 relative animate-fadeIn">
      <button
        (click)="closeModal()"
        class="absolute top-2 right-3 text-gray-500 hover:text-rose-500 text-2xl"
      >
        &times;
      </button>

      <img
        [src]="selectedProduct.image"
        [alt]="selectedProduct.name"
        class="w-full h-64 object-cover rounded-lg mb-4"
      />

      <h2 class="text-2xl font-bold text-gray-800 mb-2">
        {{ selectedProduct.name }}
      </h2>
      <p class="text-gray-600 text-sm mb-3">
        {{ selectedProduct.description }}
      </p>

      <p class="text-xl font-bold text-rose-600 mb-4">
        {{ selectedProduct.price | currency : 'USD' : 'symbol' : '1.2-2' }}
      </p>

      <div class="flex flex-col sm:flex-row gap-3">
        <button
          (click)="addToCart(selectedProduct)"
          class="flex-1 bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition"
        >
          Agregar al carrito
        </button>

        <button
          (click)="reserveNow(selectedProduct)"
          class="flex-1 border border-rose-400 text-rose-500 py-2 rounded-lg hover:bg-rose-50 transition"
        >
          Reservar producto
        </button>
      </div>
    </div>
  </div>
</div>